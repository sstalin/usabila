!function(){"use strict";angular.module("usabila",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ui.router","ui.bootstrap","toastr"])}(),function(){"use strict";function t(){function t(t){return t.availWidth<=400?"Mobile":t.availWidth>400&&t.availWidth<1e3?"Tablet":"Desktop"}var e={byScreenSize:t};return e}angular.module("usabila").factory("device",t)}(),function(){"use strict";function t(){function t(t){return _.countBy(t,function(t){return t.rating})}function e(t){var e,r=[],n=["Very Bad","Bad","Average","Good","Amazing"],i=a.count(t);for(var l in i)e={id:parseInt(l),description:n[parseInt(l)-1],count:i[l]},r.push(e);return r}var a={count:t,get:e};return a}angular.module("usabila").factory("ratings",t)}(),function(){"use strict";function t(){function t(t){var a=_.groupBy(t,function(t){return t.geo.country}),r=_.map(a,e);return r}function e(t){var e=0;for(var a in t)e+=parseInt(t[a].rating);return{average:e/t.length,country:t[0].geo.country.toLowerCase(),count:t.length}}function a(e){return t(e)}var r={getRatings:a,groupByCountry:t,iterator:e};return r}angular.module("usabila").factory("geoRating",t)}(),function(){"use strict";function t(t,e){function a(){r.ratings=e.getRatings(t)}var r=this;r.title="GeoRatingController",a()}t.$inject=["feedbacks","geoRating"],angular.module("usabila").controller("GeoRatingController",t)}(),function(){"use strict";function t(t,e){function a(){var a=e.defer();return t.get("http://cache.usabilla.com/example/apidemo.json").then(function(t){200==t.status?a.resolve(t.data.items):a.reject("failure")}),a.promise}var r={get:a};return r}t.$inject=["$http","$q"],angular.module("usabila").factory("feedback",t)}(),function(){"use strict";function t(t){function a(e,a,r,n){e.$watch("data",function(e){e&&(n.createChart(a[0],e),t.addEventListener("resize",function(){n.reset(a),n.createChart(a[0],e)}))})}var r={controller:e,link:a,restrict:"A",scope:{data:"=chartData"}};return r}function e(t){this.reset=function(t){t.find("svg").remove()},this.lineData=function(t,e){var a=d3.min(t,function(t){return t.creation_date}),r=d3.max(t,function(t){return t.creation_date}),n=Math.ceil((r-a)/e),i=function(t){for(var r,i=0;e>i;i++)if(r=a+(i+1)*n,t.creation_date<r)return i},l=_.groupBy(t,i),o=a,c=_.map(l,function(t){var e,a,r=0,i=t.length;for(var l in t)r+=parseInt(t[l].rating);return a=o+n/2,o+=n,e=r/i,{avgDate:a,avgRating:e}});return c},this.createChart=function(e,a){var r=e.clientWidth,n=e.clientHeight,i={top:20,right:10,bottom:20,left:30};if(t.d3){var l=d3.select(e).append("svg").attr("width",r).attr("height",n).attr("viewBox","0 0 "+r+" "+n),o=d3.min(a,function(t){return t.creation_date}),c=d3.max(a,function(t){return t.creation_date}),s=d3.time.scale().domain([new Date(o),new Date(c)]).range([0,r-i.left-i.right]),u=d3.svg.axis().tickSize(0).tickPadding(10).scale(s).orient("bottom");l.append("g").attr("class","x axis").attr("transform","translate("+i.left+","+(n-i.bottom)+")").call(u);var d=d3.scale.linear().domain([1,5]).range([n-i.top-i.bottom,0]),f=d3.svg.axis().ticks(5).tickSize(-(r-i.right-i.left)).tickPadding(10).scale(d).orient("left");l.append("g").attr("class","y axis").attr("transform","translate("+i.left+","+i.top+")").call(f),l.selectAll(".y.axis g").insert("circle","line").attr("r",10).attr("fill","#04A0C4").attr("cx",-14).attr("cy",0);var g=this.lineData(a,10),m=d3.svg.line().x(function(t){return s(new Date(t.avgDate))}).y(function(t){return d(t.avgRating)});l.append("path").attr("class","line").attr("d",m(g)).attr("transform","translate("+i.left+", 0)"),l.selectAll(".node-label").data(g).enter().append("circle").attr("class","node-label").attr("cx",function(t){return s(t.avgDate)}).attr("cy",function(t){return d(t.avgRating)}).attr("r",5).attr("transform","translate("+i.left+", 0)")}}}t.$inject=["$window"],e.$inject=["$window"],angular.module("usabila").directive("chart",t)}(),function(){"use strict";function t(t,e,a,r){function n(){l.filterBtn={one:{id:1,matcher:{rating:1},value:!0},two:{id:2,matcher:{rating:2},value:!0},three:{id:3,matcher:{rating:3},value:!0},four:{id:4,matcher:{rating:4},value:!0},five:{id:5,matcher:{rating:5},value:!0}},l.feedbacks=t,l.ratings=r.get(t),e.debug("DashboardController ran")}function i(t){var e=_.find(l.filterBtn,function(e){return e.matcher.rating===t.rating});return e.value}var l=this;l.items=t,l.btnFilter=i,l.device=a.byScreenSize,n()}t.$inject=["feedbacks","$log","device","ratings"],angular.module("usabila").controller("DashboardController",t)}(),function(){"use strict";function t(t){t.debug("runBlock end")}t.$inject=["$log"],angular.module("usabila").run(t)}(),function(){"use strict";function t(t,e){t.state("dashboard",{url:"/",views:{"":{templateUrl:"app/dashboard/dashboard.html",controller:"DashboardController",controllerAs:"vm"},"count@dashboard":{templateUrl:"app/components/rating-table/rating-table.html"},"graph@dashboard":{templateUrl:"app/components/chart/chart.html"},"filters@dashboard":{templateUrl:"app/components/filters/filters.html"},"table@dashboard":{templateUrl:"app/components/feedback-table/feedback-table.html"},"geo@dashboard":{templateUrl:"app/components/geo-rating/geo-rating.html",controller:"GeoRatingController",controllerAs:"vm"}},resolve:{feedbacks:["feedback",function(t){return t.get()}]}}),e.otherwise("/")}t.$inject=["$stateProvider","$urlRouterProvider"],angular.module("usabila").config(t)}(),function(){"use strict";angular.module("usabila").constant("malarkey",malarkey).constant("moment",moment)}(),function(){"use strict";function t(t,e){t.debugEnabled(!0),e.allowHtml=!0,e.timeOut=3e3,e.positionClass="toast-top-right",e.preventDuplicates=!0,e.progressBar=!0}t.$inject=["$logProvider","toastrConfig"],angular.module("usabila").config(t)}(),angular.module("usabila").run(["$templateCache",function(t){t.put("app/dashboard/dashboard.html",'<div class="container-fluid dashboard"><div class="row"><div ui-view="count" class="col-xs-12 col-md-4"></div><div ui-view="graph" class="col-xs-12 col-md-8"></div></div><div ui-view="filters"></div><div ui-view="table"></div><div class="row"><div ui-view="geo" class="col-xs-12 col-md-6"></div></div></div>'),t.put("app/components/chart/chart.html",'<div class="chart-container" chart="" chart-data="vm.feedbacks"></div>'),t.put("app/components/filters/filters.html",'<section class="row filter-bar"><div class="col-xs-12 col-md-2 filter-wrap"><input class="search form-control" type="text" placeholder="Search here!" ng-model="vm.searchText"></div><div class="col-xs-12 col-md-10 filter-wrap"><label><input type="checkbox" ng-model="vm.filterBtn.one.value"> <span class="rating big" ng-class="{filterOn: vm.filterBtn.one.value, filterOff: !vm.filterBtn.one.value}">1</span></label> <label><input type="checkbox" ng-model="vm.filterBtn.two.value"> <span class="rating big" ng-class="{filterOn: vm.filterBtn.two.value, filterOff: !vm.filterBtn.two.value}">2</span></label> <label><input type="checkbox" ng-model="vm.filterBtn.three.value"> <span class="rating big" ng-class="{filterOn: vm.filterBtn.three.value, filterOff: !vm.filterBtn.three.value}">3</span></label> <label><input type="checkbox" ng-model="vm.filterBtn.four.value"> <span class="rating big" ng-class="{filterOn: vm.filterBtn.four.value, filterOff: !vm.filterBtn.four.value}">4</span></label> <label><input type="checkbox" ng-model="vm.filterBtn.five.value"> <span class="rating big" ng-class="{filterOn: vm.filterBtn.five.value, filterOff: !vm.filterBtn.five.value}">5</span></label></div></section>'),t.put("app/components/feedback-table/feedback-table.html",'<table class="table table-hover feedback-table"><thead class="header"><tr><th>Rating</th><th>Comment</th><th>Browser</th><th>Device</th><th>Platform</th></tr></thead><tbody><tr ng-repeat="item in vm.items | filter:vm.btnFilter | filter:vm.searchText track by item.id"><th scope="row"><span class="rating big">{{::item.rating}}</span></th><td><p>{{::item.comment}}</p></td><td class="text-center"><p>{{::item.computed_browser.Browser}}</p><p>{{::item.computed_browser.Version}}</p></td><td><p>{{vm.device(item);}}</p></td><td><p>{{::item.computed_browser.Platform}}</p></td></tr></tbody></table>'),t.put("app/components/geo-rating/geo-rating.html",'<table class="table table-hover geo-table"><thead class="header"><tr><th>Flag</th><th>Country Code</th><th>Average Rating</th><th>Count</th></tr></thead><tbody><tr ng-repeat="r in vm.ratings track by $index"><th><span class="flag" ng-class="r.country"></span></th><td>{{r.country.toUpperCase();}}</td><td>{{r.average | number:2}}</td><td>{{r.count}}</td></tr></tbody></table>'),t.put("app/components/rating-table/rating-table.html",'<table class="table table-hover"><thead><tr><th>Ratings</th><th># Items</th></tr></thead><tbody><tr ng-repeat="r in vm.ratings track by r.id"><th><span class="rating small">{{r.id}}</span> <span>{{r.description}}</span></th><td>{{r.count}}</td></tr></tbody></table>')}]);
//# sourceMappingURL=../maps/scripts/app-a1b627239d.js.map
